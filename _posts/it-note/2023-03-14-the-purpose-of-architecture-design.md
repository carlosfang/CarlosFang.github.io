---
layout: post
title: 架构设计的目的
date: 2023-03-14 10:12:15
categories: 系统设计
tags: 极客时间 技术学习笔记
excerpt: 架构设计的主要目的是为解决软件系统复杂带来的问题
---

# 架构设计的真正目的

架构设计的主要目的是为解决软件系统复杂带来的问题。

架构即决策，用有限的资源合适地去解决当前的问题。有限的资源是：团队经验，成本，进度，业务背景，人，财，物，时间等。

需求驱动架构，架起分析与设计之实现的桥梁。 

架构师有的放矢，而不是贪大求全。 

系统的复杂度体现在哪里？主要体现在五个方面。

- 性能
- 可扩展性
- 高可用
- 安全性
- 成本

# 高性能

软件系统的高性能带来的复杂度主要体现在两方面， 一方面是单机计算机内部为了高性能带来的复杂度。另一个方面是多台计算机集群为了高性能带来的复杂度。 

### 单机复杂度

计算机内部复杂度最关键的地方就是操作系统。 

操作系统和性能最相关的就是进程和线程。 

多进程多线程并行处理任务。 

### 集群复杂度

通过大量机器来提升性能时，就是让多台机器很好的配合，这就带来一个集群的复杂度。 如：

1、任务分解

通过任务分解，把一个大任务分解成小任务，分配到不同机器上去处理。

2、任务分配

不同机器可以处理不同的业务任务，这时就需要把任务分配不同的机器上。 


性能是软件一个重要属性，衡量软件性能包括了响应时间、TPS、服务器资源的利用率等客户指标。 


为什么需要高性能？

- 追求良好的用户体验
- 满足业务增长的需要



如何做好高性能？

- 可以从垂直和水平两个维度来考虑。 

  - 垂直：针对单机计算机，通过升级软件、硬件能力实现性能提升。
  - 水平：针对集群系统，利用合理任务分解和任务分配来提升。

- 垂直维度的措施：

  - 增大内存减少I/O。
  - 固态硬盘，提升I/O访问速度。 
  - 用 RAID 增加I/O的吞吐能务。
  - 增加处理器，提高算力。
  - 升级网络带宽。

- 水平维度的措施：

  - 功能分解，把系统分解为多个子系统，微服务。 
  - 多实例副本，同一组件重复部署到多台不 的服务器。
  - 数据分割，在每台机器上都只部署一部分数据。

垂直维度方案比较适合业务的早期，主要从成本考虑。水平维度的方案适合在业务发展到一定程度。水平维度是技术发展的必经之路。 

# 高可用

> 系统无中断地执行其功能的能力，代表系统的可用性程度，是进行系统设计的时的准则之一。 

从系统内各个层面上看，“无中断”是几乎不可能的。硬件、软件、外部环境都可能导致难以预测是的问题。 

从系统这个维度上看，**高可用的本质就是通过“冗余”来实现**。即一台有问题，又一台顶着。一个机房有问题，有另一个机器扛着。 

高可用主要从三方面考虑：

- 高可用计算。业务逻辑的处理，无论在哪台机器上进行计算，同样的算法和输入数据，输出结果都是一样。
- 高可用存储。存储高可用的难点不是在于如何备份数据，而在于如何减少或者规避数据不一致对业务造成的影响。
- 高可用状态决策。即系统需要能够判断当前的状态是正常还是异常，如果出现了异常就要采取行动来保证高呆用。 

为什么会出现不可用？

- 硬件故障。应用运用到服务器中，现有的服务器有一些是普通的PC机，有一些docker 虚拟机的形式提供服务。本身就不具备高可用性。
- 软件BUG。 BUG 不能消灭，只能减少。
- 不可抗拒力。如地震，水灾，战争等。 

高可用的方案不是解决，而是减少或者规避。规避某个问题，一般可能会引来另一个问题，只是这个问题比之前的问题小。

高可用的设计过程其实也是一个取舍的过程。 这也是什么系统可用性永远只是几个九，不可能百分之一百。 


# 可扩展性

可扩展性指的系统为了应对未来的需求而提供一种方便的扩展能力。当未来的某一个新需求出现时，系统以最小成本就可以支持，如只改配置或改动很少的代码。

设计具备良好的可扩展性的系统，有两个基本条件，正确预测变化、完美封闭变化。

### 预测变化

预测变化的复杂性在于：

- 不能每个设计点都考虑可扩展性。 
- 不能完全不考虑可扩展性。
- 所有的预测都存在出错的可能性。

如何把握好预测的程序，提升预测结果的准备性，靠的就是自己的经验，直觉。小心过度设计，把系统搞得更加复杂了。

### 应对变化

应对未来的变化，可以把系统进行分层，可能出现变化的和比较稳定的分好模块。 

- 系统需要拆分出变化层和稳定层。
- 需要设计变化层和稳定层之间的接口。

什么是架构的可扩展性？

业务需求、运行环境方面的变化都会导致软件系统的发生变化，而这种软件对上述变化**适应能力**就是可扩展性。

一个具备良好可扩展性的架构设计应该当符合**开闭原则**：对扩展开放，对修改关闭。

主要表现为：

- 软件内部方面。在软件系统实现新增的业务功能时，对现有系统功能影响较少，即不需要对现在功能作任何发动或很少改动。
- 软件外面方面。软件系统本身与其他方协同之间存在松耦关系，自身的变化对外部系统无影响。

如何设计可扩展性好的架构？

面向对象思想，设计模式等都是为了解决可扩展性而出现的方法与技术。 

可以从两角度思考：

1、从业务维度。对业务深入的理解，对可预计的业务变化进行预测。

2、从技术维度。 利用扩展好的技术，实现对变化的封装。

在实际工作场景中常用的手段：

- 使用分布式服务构建可复用的业务平台。
- 使用分布式消息队列降低模块间的耦合性。
- 稳定层可以考虑服务化。

# 低成本、安全、规模

复杂度另外三个来源： 成本，安全和规模。 

## 成本

如果我们的架方案涉及到几百上千甚至上万台机器时，成本就是一个很重要的考虑点了。

当我们的架构设计“高可用、高性能”时，带来的就是更多服务器的高成本。 所以，低成本也成了架构设计的一个约束条件。

架构设计之前， 我们要设定一个成本目标，我的架构设计高可有，高性能也要满足这个成本目标。如果不行则要重新考虑方案。

为了降低成本，同时也是高可用，和性能架构。 一般的做法就是引入新技术。如：

- NoSQL （Redis、Memcache）做缓存解决高平发访问的问题
- 全文搜索引擎 (Sphinx 、Elasticsearache、Solr) 解决数据库搜索低效问题
- Hadoop 解决海量数据存储和计算的问题。 

## 安全

安全是一个大又复杂的技术领域，一旦出问题，对业务和企业的影响很大。

从技术的角度来讲，安全可以分为两类：

- 功能上的安全 （防小偷）
- 架构上的安全 （防强盗）

**功能上安全**

如：XSS 攻击、CSRF攻击、SQL流入、系统漏洞、密码破解等。 问题很多时候出现在编码不严谨的时候，这一个逐步完善的过程。 

**架构上的安全**

传统的架构安全主是依靠防火墙。 防火墙的基本功能就是网络隔离，通过将网络划分成不同的区域，制定出不同区域的之间的访问控制策略来控制不同坐诊和程度区域传送的数据流。 

互联网系统的架构安全目前并没有太好的设计手段来实现，更多地是依靠运营商或者云服务商强大的带宽和流量清洗的能力，自己的设计的架构上能做的事比较少。 

## 规模

规模带来的复杂度主要是因为“量变引起质变” 。

常用的规模带来的复杂度有：

1、功能越来越多，导致德比主复杂度指数级上升。 

2、数据越来越多，系统复杂度发生质变。 

规模问题需要与高性能、高可用、高扩展、高伸缩性统一考虑。常采用“分而治之，各个击破”的方法策略。

## 可伸缩性

伸缩性一般是系统可以根据需求和成本调整自身处理能力的一种能力。伸缩性常意味着系统可以通过低成本并能够快速改变自身的处理能力以满足更多用户访问、处理更多数据而不会对用户体验造
成任何影响。

伸缩性度量指标包括: 

- 处理更高并发。
- 处理更多数据。
- 处理更高频次的用户交互。

其复杂度体现在：

- 伸——增强系统在上述三个方面的处理能力。
- 缩——缩减系统处理能力。 
- 上述伸缩过程还必须相对低成本和快速。

----
1、《从零开始学架构》 李运华


