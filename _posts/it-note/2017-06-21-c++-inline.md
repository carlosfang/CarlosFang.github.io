---
layout: post
title: c++ inline 内联函数 
date: 2017-06-21 16:12:15
categories: c++  
tags: c++  技术学习笔记
excerpt: inline 在调用时并不通过函数调用的机制而是直接在调用点处展开
---


1、 `inline` 是一个关键字，可以用于定义内联函数。内联函数，像普通函数一样被调用，但是在调用时并不通过函数调用的机制而是直接在调用点处展开，这样可以大大减少由函数调用带来的开销，从而提高程序的运行效率。

2、 类内定义成员函数默认是内联函数。在类内定义成员函数，可以不用在函数头部加 `inline` 关键字，因为编译器会自动将类内定义的函数（构造函数、析构函数、普通成员函数等）声明为内联函数。 

3、类外定义成员函数，若想定义为内联函数，需用关键字声明。当在类内声明函数，在类外定义函数时，如果想将该函数定义为内联函数，则可以在类内声明时不加 `inline` 关键字，而在类外定义函数时加上 `inline` 关键字。

4、另外，可以在声明函数和定义函数的同时加上 `inline`；也可以只在函数声明时加 `inline`，而定义函数时不加 `inline`。只要确保在调用该函数之前把 `inline` 的信息告知编译器即可。

```c++
#include <iostream>
using namespace std;

class A{
public:
    int var;
    A(int tmp){ 
      var = tmp;
    }    
    void fun(){ 
        cout << var << endl;
    }
};
```

5、`inline` 作用及使用方法

- 内联函数不是在调用时发生控制转移关系，而是在编译阶段将函数体嵌入到每一个调用该函数的语句块中，编译器会将程序中出现内联函数的调用表达式用内联函数的函数体来替换。
- 普通函数是将程序执行转移到被调用函数所存放的内存地址，当函数执行完后，返回到执行此函数前的地方。转移操作需要保护现场，被调函数执行完后，再恢复现场，该过程需要较大的资源开销。

6、 宏定义（`define`）和内联函数（`inline`）的区别

- 内联函数是在编译时展开，而宏在编译预处理时展开；在编译的时候，内联函数直接被嵌入到目标代码中去，而宏只是一个简单的文本替换。
- 内联函数是真正的函数，和普通函数调用的方法一样，在调用点处直接展开，避免了函数的参数压栈操作，减少了调用的开销。而宏定义编写较为复杂，常需要增加一些括号来避免歧义。
- 宏定义只进行文本替换，不会对参数的类型、语句能否正常编译等进行检查。而内联函数是真正的函数，会对参数的类型、函数体内的语句编写是否正确等进行检查。
